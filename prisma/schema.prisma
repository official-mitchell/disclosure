generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id              String           @id @default(uuid())
  name            String           @unique
  pin             String
  country         Country
  archetype       Archetype
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  demeanor        Demeanor?        @default(AGNOSTIC)
  character       Character?
  clueAssignments ClueAssignment[]
}

model Clue {
  id              String           @id @default(uuid())
  title           String
  phase           Int
  released        Boolean          @default(false)
  releasedAt      DateTime?
  retracted       Boolean          @default(false)
  legitimacy      Legitimacy
  confidentiality Confidentiality
  originCountry   String
  eventDate       String
  backstory       String
  imageUrl        String?
  confidenceLevel ConfidenceLevel
  supportingIntel String
  source          String
  takeaways       String[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  targetCountry   Country?
  targetArchetype Archetype?
  targetDemeanor  Demeanor?
  targetPlayer    String?
  clueAssignments ClueAssignment[]
}

model ClueAssignment {
  id         String   @id @default(uuid())
  clueId     String
  playerId   String
  assignedAt DateTime @default(now())
  clue       Clue     @relation(fields: [clueId], references: [id], onDelete: Cascade)
  player     Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([clueId, playerId])
  @@index([playerId])
  @@index([clueId])
}

model Character {
  id                   String   @id @default(uuid())
  playerId             String   @unique
  displayName          String
  nationalityBloc      String
  occupation           String
  publicReputation     String
  portraitUrl          String?
  archetypeTitle       String
  permissions          String[]
  restrictions         String[]
  backstory            String
  motivations          Json
  exposureConsequences String
  privateWant          String
  disclosureBelief     String
  canDiscuss           String[]
  mustConceal          String[]
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  covertOccupation     String?
  formalAuthority      String[]
  informalFears        String[]
  safelyIgnore         String[]
  player               Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

enum Country {
  RUSSIA
  US
  CHINA
}

enum Archetype {
  SCIENTIST
  SPY
  DIPLOMAT
  GENERAL
  EXECUTIVE
  JOURNALIST
  OPERATIVE
  MILITARY_DEFENSE_CONTRACTOR
  HIGH_RANKING_POLITICIAN
  INTEL_OLIGARCH
  JOURNALIST_MEDIA
  HIGH_RANKING_SCIENTIST
}

enum Demeanor {
  ANTI_DISCLOSURE
  AGNOSTIC
  PRO_DISCLOSURE
}

enum Legitimacy {
  verified
  suspected
  fabricated
  unknown
}

enum Confidentiality {
  top_secret
  confidential
  shareable_if_pressed
  public
}

enum ConfidenceLevel {
  confirmed
  high
  medium
  low
  unverified
}

enum TargetType {
  all
  country
  archetype
  player
}
